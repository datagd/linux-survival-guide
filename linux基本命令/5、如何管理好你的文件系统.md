







[TOC]

# 5.1 linux文件系统简介

# 5.2 操作文件系统

linux官方提供了一些工具，可以使我们运用命令行的方式去处理linux文件系统。

## 5.2.1 创建硬盘分区

分区是将一个硬盘驱动器分成若干个逻辑驱动器，分区可以是把硬盘连续的区块当做一个独立的硬盘使用。

要想创建硬盘分区首先你得有一个硬盘，当然也可以使用现有硬盘剩余的部分。一般情况下，如果在我们的服务器上新加硬盘是可以被linux系统识别到的。但是，也会存在一些这样或那样的原因，新加的硬盘无法被识别到。恰好这时我们不想重启服务器解决这个问题，那么就需要对系统进行扫盘了。

```
如果不知道新加硬盘挂载的位置，可以先查看现有硬盘挂载的适配器。
#ls -l /sys/block/sda
lrwxrwxrwx. 1 root root 0 Jan  2 01:42 /sys/block/sda -> ../devices/pci0000:00/0000:00:10.0/host0/target0:0:0/0:0:0:0/block/sda
发现正在磁盘挂载到host0，可以用以下命令，重新扫描host0信息 
#echo "- - -" > /sys/class/scsi_host/host0/scan
然后查看新加硬盘是否被识别到
#lsblk  
```



### 5.2.1 fdisk命令详解

fdisk工具是的linux的一个交互式程序，你可以使用它来一步步完成对linux的配置。fdisk命令交互时使用单字母实现功能。

我们可以通过m命令查看所有可用命令：

```shell
[root@localhost block]# fdisk /dev/sdb
Welcome to fdisk (util-linux 2.23.2).

Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.

Device does not contain a recognized partition table
Building a new DOS disklabel with disk identifier 0x22d3afdf.

Command (m for help): help
h: unknown command
Command action
   a   toggle a bootable flag
   b   edit bsd disklabel
   c   toggle the dos compatibility flag
   d   delete a partition
   g   create a new empty GPT partition table
   G   create an IRIX (SGI) partition table
   l   list known partition types
   m   print this menu
   n   add a new partition
   o   create a new empty DOS partition table
   p   print the partition table
   q   quit without saving changes
   s   create a new empty Sun disklabel
   t   change a partition's system id
   u   change display/entry units
   v   verify the partition table
   w   write table to disk and exit
   x   extra functionality (experts only)
```

实际中，我们可能用到的命令比较少，你只需要记住以下命令就好，当然其他命令你最好也有所了解。

p命令打印出现在的分区情况，因为我是一个空的硬盘，所以啥也没有。

```shell
[root@localhost block]# fdisk /dev/sdb 
Welcome to fdisk (util-linux 2.23.2).

Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.

Device does not contain a recognized partition table
Building a new DOS disklabel with disk identifier 0x9fefc86f.

Command (m for help): p

Disk /dev/sdb: 53.7 GB, 53687091200 bytes, 104857600 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0x9fefc86f

   Device Boot      Start         End      Blocks   Id  System
```

n命令添加一个新分区；p选项表示创建一个主分区，1表示分区号（每个存储设备最多只能有4个主分区）；

first sector选项中默认从第2048块扇区开始是因为,由于EFI的兴起，要给EFI 代码留磁盘最开始的1M空间；

```shell
Command (m for help): n
Partition type:
   p   primary (0 primary, 0 extended, 4 free)
   e   extended
Select (default p): p
Partition number (1-4, default 1): 1
First sector (2048-104857599, default 2048): 
Using default value 2048
Last sector, +sectors or +size{K,M,G} (2048-104857599, default 104857599): +2G
Partition 1 of type Linux and of size 2 GiB is set

```

p命令再次查看分区情况；此时发现设备上多了一个分区。默认id为83(Linux ext2)，fdisk下使用l可以查看所有的id类型；

w命令将更改保存到存储设备上。

```shell
Command (m for help): p

Disk /dev/sdb: 53.7 GB, 53687091200 bytes, 104857600 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0x9fefc86f

   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1            2048     4196351     2097152   83  Linux

Command (m for help): w
The partition table has been altered!

Calling ioctl() to re-read partition table.
Syncing disks.
```

创建完分区后，可以将其格式化创建文件系统了。

### 5.2.2 parted命令详解

parted是一个用于硬盘分区或调整分区大小的工具。使用它你可以轻松的创建、清除、调整、移动和复制ext2、ext3、linux-swap、FAT、FAT32和reiserfs分区。

使用parted --help命令可以获取所有parted命令：

```shell
[root@localhost block]# parted --help
Usage: parted [OPTION]... [DEVICE [COMMAND [PARAMETERS]...]...]
Apply COMMANDs with PARAMETERS to DEVICE.  If no COMMAND(s) are given, run in
interactive mode.

OPTIONs:
  -h, --help                      displays this help message
  -l, --list                      lists partition layout on all block devices
  -m, --machine                   displays machine parseable output
  -s, --script                    never prompts for user intervention
  -v, --version                   displays the version
  -a, --align=[none|cyl|min|opt]  alignment for new partitions

COMMANDs:
  align-check TYPE N                        check partition N for TYPE(min|opt)
        alignment
  help [COMMAND]                           print general help, or help on
        COMMAND
  mklabel,mktable LABEL-TYPE               create a new disklabel (partition
        table)
  mkpart PART-TYPE [FS-TYPE] START END     make a partition
  name NUMBER NAME                         name partition NUMBER as NAME
  print [devices|free|list,all|NUMBER]     display the partition table,
        available devices, free space, all found partitions, or a particular
        partition
  quit                                     exit program
  rescue START END                         rescue a lost partition near START
        and END
  
  resizepart NUMBER END                    resize partition NUMBER
  rm NUMBER                                delete partition NUMBER
  select DEVICE                            choose the device to edit
  disk_set FLAG STATE                      change the FLAG on selected device
  disk_toggle [FLAG]                       toggle the state of FLAG on selected
        device
  set NUMBER FLAG STATE                    change the FLAG on partition NUMBER
  toggle [NUMBER [FLAG]]                   toggle the state of FLAG on partition
        NUMBER
  unit UNIT                                set the default unit to UNIT
  version                                  display the version number and
        copyright information of GNU Parted

Report bugs to bug-parted@gnu.org
```

parted可以使用交换式的命令操作，也支持命令行方式，主要看一下常用的交互式方式的操作，方便理解。

p命令可以输出当前分区情况。

```
[root@localhost ~]# parted /dev/sdb
GNU Parted 3.1
Using /dev/sdb
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted) p                                                                
Model: VMware Virtual disk (scsi)
Disk /dev/sdb: 53.7GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags: 

Number  Start  End  Size  File system  Name  Flags

```

mklabel命令创建磁盘标签。

mkpart命令创建分区，其中Partition name?表示你要创建的分区名称；start？表示你的分区从哪开始，此处你可以填写具体的大小比如10G，也可以用百分比，比如0%从0开始，但是如果你在此处写0可能会报错，这里涉及到一些问题，建议填写0%；end？表示分区在哪结束，可以填写具体的大小或者使用100%、-1来表示应用整个磁盘。

```
(parted) mklabel gpt
Warning: The existing disk label on /dev/sdb will be destroyed and all data on this disk will be lost. Do you want to continue?
Yes/No? y                                                                 
(parted) mkpart                                                           
Partition name?  []? primary                                              
File system type?  [ext2]? ext4                                           
Start? 0%                                                                 
End? 30G                                                                  
(parted) p                                                                
Model: VMware Virtual disk (scsi)
Disk /dev/sdb: 53.7GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags: 

Number  Start   End     Size    File system  Name     Flags
 1      1049kB  30.0GB  30.0GB               primary

```

让我们用剩余的磁盘空间再来创建一个新的分区。

rm 命令可以帮助我们删除创建错误的分区。

```
(parted) mkpart                                                           
Partition name?  []? secondary                                            
File system type?  [ext2]? ext4                                           
Start? 30G                                                                
End? -1                                                                   
(parted) p                                                                
Model: VMware Virtual disk (scsi)
Disk /dev/sdb: 53.7GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags: 

Number  Start   End     Size    File system  Name       Flags
 1      1049kB  30.0GB  30.0GB               primary
 2      30.0GB  53.7GB  23.7GB               secondary

(parted) rm 2                                                             
(parted) p                                                                
Model: VMware Virtual disk (scsi)
Disk /dev/sdb: 53.7GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags: 

Number  Start   End     Size    File system  Name     Flags
 1      1049kB  30.0GB  30.0GB               primary

(parted) q                                                                
Information: You may need to update /etc/fstab.
```

当然你也可以使用命令行方式直接对分区进行操作，格式如下：

```shell
parted /dev/sda -s -- mklabel gpt
parted /dev/sda -s -- mkpart primary 0% 100%
```



### 5.2.3 parted与fdisk的区别

两个命令都能对硬盘进行分区，但是也存在一些区别，具体可以根据的你分区大小、磁盘用途等进行选择。

相比于fdisk命令parted最大的优点应该支持2TB以上的磁盘分区，现在IT发达，技术日新月异，尤其是在大数据、云计算、AI等方面对于空间要求越来越大，硬盘需求数T是很常见的，直接提高了parted工具的使用。

fdisk命令只支持msdos，分区的时候只支持小容量硬盘（<=2T），但是如果不需要分区的话，那么整块sdb硬盘，类型为msdos，那么他的大小是可以大于2T的。

parted并且允许调整分区的大小。

## 5.2.2 创建文件系统





